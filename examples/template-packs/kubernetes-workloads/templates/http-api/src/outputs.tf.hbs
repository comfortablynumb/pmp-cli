output "namespace" {
  description = "Kubernetes namespace where the application is deployed"
  value       = kubernetes_namespace.app.metadata[0].name
}

output "deployment_name" {
  description = "Name of the Kubernetes deployment"
  value       = kubernetes_deployment.app.metadata[0].name
}

output "service_name" {
  description = "Name of the Kubernetes service"
  value       = kubernetes_service.app.metadata[0].name
}

output "service_type" {
  description = "Type of Kubernetes service"
  value       = kubernetes_service.app.spec[0].type
}

output "http_port" {
  description = "HTTP port exposed by the service"
  value       = var.http_port
}

output "min_replicas" {
  description = "Minimum number of replicas (HPA)"
  value       = var.min_replicas
}

output "max_replicas" {
  description = "Maximum number of replicas (HPA)"
  value       = var.max_replicas
}

output "cpu_limit" {
  description = "CPU limit per pod"
  value       = "${var.cpu_millicores}m"
}

output "memory_limit" {
  description = "Memory limit per pod"
  value       = "${var.memory_mb}Mi"
}

output "access_instructions" {
  description = "Instructions for accessing the service"
  value = var.service_type == "NodePort" ? "Access via NodePort: kubectl get service {{k8s_name name}} -n {{k8s_name name}} -o jsonpath='{.spec.ports[0].nodePort}'" : var.service_type == "LoadBalancer" ? "Access via LoadBalancer: kubectl get service {{k8s_name name}} -n {{k8s_name name}} -o jsonpath='{.status.loadBalancer.ingress[0].ip}'" : "Access internally via: {{k8s_name name}}.{{k8s_name name}}.svc.cluster.local:${var.http_port}"
}

output "kubectl_commands" {
  description = "Useful kubectl commands for managing the deployment"
  value = <<-EOT
    # Get pods
    kubectl get pods -n {{k8s_name name}} -l app.kubernetes.io/name={{name}}

    # Get service
    kubectl get service {{k8s_name name}} -n {{k8s_name name}}

    # Get HPA status
    kubectl get hpa {{k8s_name name}} -n {{k8s_name name}}

    # View logs
    kubectl logs -n {{k8s_name name}} -l app.kubernetes.io/name={{name}} --tail=100 -f

    # Port-forward for local access
    kubectl port-forward -n {{k8s_name name}} service/{{k8s_name name}} 8080:${var.http_port}
  EOT
}
