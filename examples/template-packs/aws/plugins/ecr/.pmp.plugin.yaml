apiVersion: pmp.io/v1
kind: Plugin
metadata:
  name: ecr
  description: Create an AWS ECR repository for your application containers with opinionated defaults

spec:
  role: container-registry

  inputs:
    # Project Metadata
    project_name:
      type: string
      description: ECR repository name (defaults to project name)
      default: ""

    # Basic Settings
    image_tag_mutability:
      type: select
      options:
        - label: "Mutable (Tags can be overwritten)"
          value: "MUTABLE"
        - label: "Immutable (Tags are permanent)"
          value: "IMMUTABLE"
      default: "MUTABLE"
      description: Tag mutability setting for the repository

    # Encryption Settings
    encryption_type:
      type: select
      options:
        - label: "AES256 (AWS Managed)"
          value: "AES256"
        - label: "KMS (Customer Managed)"
          value: "KMS"
      default: "AES256"
      description: Encryption type for images at rest

    enable_kms_key_rotation:
      type: boolean
      description: Enable automatic key rotation for KMS keys (only when encryption_type is KMS)
      default: true

    # Image Scanning
    scan_on_push:
      type: boolean
      description: Enable automatic image scanning when images are pushed
      default: true

    # Lifecycle Policy Settings
    enable_lifecycle_policy:
      type: boolean
      description: Enable lifecycle policy to automatically clean up old images
      default: true

    keep_image_count:
      type: select
      options:
        - label: "5 images"
          value: "5"
        - label: "10 images"
          value: "10"
        - label: "15 images"
          value: "15"
        - label: "20 images"
          value: "20"
        - label: "30 images"
          value: "30"
      default: "10"
      description: Number of tagged images to retain (for lifecycle policy)

    expire_untagged_after_days:
      type: select
      options:
        - label: "1 day"
          value: "1"
        - label: "3 days"
          value: "3"
        - label: "7 days"
          value: "7"
        - label: "14 days"
          value: "14"
      default: "7"
      description: Number of days to keep untagged images before expiring them
