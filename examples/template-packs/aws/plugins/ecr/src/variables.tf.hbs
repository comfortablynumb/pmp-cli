# Project metadata variables (injected by PMP)
variable "project_name" {
  type        = string
  description = "Project name (injected by PMP)"
}

# Override Variables
variable "repository_name_override" {
  type        = string
  description = "Override ECR repository name (default uses project name)"
  default     = "{{repository_name_override}}"
}

# Basic Settings
variable "image_tag_mutability" {
  type        = string
  description = "Tag mutability setting for the repository"
  default     = "{{image_tag_mutability}}"

  validation {
    condition     = contains(["MUTABLE", "IMMUTABLE"], var.image_tag_mutability)
    error_message = "Image tag mutability must be either MUTABLE or IMMUTABLE."
  }
}

# Encryption Settings
variable "encryption_type" {
  type        = string
  description = "Encryption type for images at rest"
  default     = "{{encryption_type}}"

  validation {
    condition     = contains(["AES256", "KMS"], var.encryption_type)
    error_message = "Encryption type must be either AES256 or KMS."
  }
}

variable "enable_kms_key_rotation" {
  type        = bool
  description = "Enable automatic key rotation for KMS keys"
  default     = {{bool enable_kms_key_rotation}}
}

# Image Scanning
variable "scan_on_push" {
  type        = bool
  description = "Enable automatic image scanning when images are pushed"
  default     = {{bool scan_on_push}}
}

# Lifecycle Policy Settings
variable "enable_lifecycle_policy" {
  type        = bool
  description = "Enable lifecycle policy to automatically clean up old images"
  default     = {{bool enable_lifecycle_policy}}
}

variable "keep_image_count" {
  type        = number
  description = "Number of tagged images to retain (for lifecycle policy)"
  default     = {{keep_image_count}}

  validation {
    condition     = var.keep_image_count > 0 && var.keep_image_count <= 100
    error_message = "Keep image count must be between 1 and 100."
  }
}

variable "expire_untagged_after_days" {
  type        = number
  description = "Number of days to keep untagged images before expiring them"
  default     = {{expire_untagged_after_days}}

  validation {
    condition     = var.expire_untagged_after_days > 0 && var.expire_untagged_after_days <= 365
    error_message = "Expire untagged after days must be between 1 and 365."
  }
}
