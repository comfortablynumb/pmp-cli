# Repository Information
output "repository_name" {
  description = "The name of the ECR repository"
  value       = aws_ecr_repository.plugin_repo.name
}

output "repository_url" {
  description = "The URL of the ECR repository"
  value       = aws_ecr_repository.plugin_repo.repository_url
}

output "repository_arn" {
  description = "The ARN of the ECR repository"
  value       = aws_ecr_repository.plugin_repo.arn
}

output "registry_id" {
  description = "The registry ID where the repository was created"
  value       = aws_ecr_repository.plugin_repo.registry_id
}

# Quick Start Commands
output "docker_commands" {
  description = "Docker commands for this ECR repository"
  value = <<-EOT
    # Login to ECR
    aws ecr get-login-password --region ${data.aws_region.current.name} | \
      docker login --username AWS --password-stdin ${aws_ecr_repository.plugin_repo.repository_url}

    # Build and tag your image
    docker build -t ${aws_ecr_repository.plugin_repo.name}:latest .
    docker tag ${aws_ecr_repository.plugin_repo.name}:latest ${aws_ecr_repository.plugin_repo.repository_url}:latest

    # Push to ECR
    docker push ${aws_ecr_repository.plugin_repo.repository_url}:latest

    # Pull from ECR
    docker pull ${aws_ecr_repository.plugin_repo.repository_url}:latest
  EOT
}

# Integration Information
output "integration_info" {
  description = "ECR repository integration information"
  value = {
    repository_url  = aws_ecr_repository.plugin_repo.repository_url
    repository_name = aws_ecr_repository.plugin_repo.name
    repository_arn  = aws_ecr_repository.plugin_repo.arn
    registry_id     = aws_ecr_repository.plugin_repo.registry_id
    aws_region      = data.aws_region.current.name
    aws_account_id  = data.aws_caller_identity.current.account_id
  }
}

# Data sources for current AWS context
data "aws_region" "current" {}
data "aws_caller_identity" "current" {}
