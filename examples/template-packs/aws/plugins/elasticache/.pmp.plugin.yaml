apiVersion: pmp.io/v1
kind: Plugin
metadata:
  name: elasticache
  description: Create an AWS ElastiCache cluster (Redis or Memcached) with opinionated defaults for caching and session management

spec:
  role: cache

  inputs:
    # Project Metadata
    - name: project_name
      type: string
      description: ElastiCache cluster name (defaults to project name)
      default: ""

    # Engine Configuration
    - name: engine
      type: select
      options:
        - label: "Redis (In-memory data structure store)"
          value: "redis"
        - label: "Memcached (High-performance distributed memory cache)"
          value: "memcached"
      default: "redis"
      description: Cache engine type

    - name: engine_version
      type: string
      description: Engine version (e.g., "7.0" for Redis, "1.6.17" for Memcached)
      default: "7.0"

    # Cluster Configuration
    - name: node_type
      type: select
      options:
        - label: "cache.t3.micro (0.5 GB RAM)"
          value: "cache.t3.micro"
        - label: "cache.t3.small (1.37 GB RAM)"
          value: "cache.t3.small"
        - label: "cache.t3.medium (3.09 GB RAM)"
          value: "cache.t3.medium"
        - label: "cache.r7g.large (13.07 GB RAM)"
          value: "cache.r7g.large"
        - label: "cache.r7g.xlarge (26.32 GB RAM)"
          value: "cache.r7g.xlarge"
      default: "cache.t3.small"
      description: Node instance type

    - name: num_cache_nodes
      type: number
      description: Number of cache nodes (1-20 for Memcached, 1-6 for Redis without cluster mode)
      default: 1
      min: 1
      max: 20

    - name: parameter_group_family
      type: string
      description: Parameter group family (e.g., "redis7", "memcached1.6")
      default: "redis7"

    - name: port
      type: number
      description: Port number (6379 for Redis, 11211 for Memcached)
      default: 6379
      min: 1024
      max: 65535

    # Security Settings
    - name: at_rest_encryption_enabled
      type: boolean
      description: Enable encryption at rest (Redis only)
      default: true

    - name: transit_encryption_enabled
      type: boolean
      description: Enable encryption in transit (Redis only)
      default: true

    - name: auth_token_enabled
      type: boolean
      description: Enable Redis AUTH token for authentication (Redis only)
      default: false

    # Backup Settings
    - name: snapshot_retention_limit
      type: number
      description: Number of days to retain automatic snapshots (Redis only, 0 to disable)
      default: 5
      min: 0
      max: 35

    - name: snapshot_window
      type: string
      description: Daily time range for automatic snapshots in UTC (e.g., "05:00-09:00")
      default: "05:00-09:00"

    # Maintenance Settings
    - name: maintenance_window
      type: string
      description: Weekly time range for maintenance in UTC (e.g., "sun:05:00-sun:07:00")
      default: "sun:05:00-sun:07:00"

    - name: auto_minor_version_upgrade
      type: boolean
      description: Enable automatic minor version upgrades during maintenance window
      default: true

    # Network Settings
    - name: subnet_ids
      type: string
      description: Comma-separated list of subnet IDs for the cache subnet group
      default: ""

    - name: security_group_ids
      type: string
      description: Comma-separated list of security group IDs
      default: ""
