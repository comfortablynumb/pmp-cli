output "memorydb_cluster_name" {
  description = "MemoryDB cluster name"
  value       = aws_memorydb_cluster.plugin_memorydb.name
}

output "memorydb_cluster_endpoint" {
  description = "Cluster configuration endpoint"
  value       = aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].address
}

output "memorydb_cluster_port" {
  description = "Port number the cluster accepts connections on"
  value       = aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].port
}

output "memorydb_endpoint" {
  description = "Full endpoint connection string"
  value       = "${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].address}:${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].port}"
}

output "memorydb_reader_endpoint" {
  description = "Reader endpoint for read replicas"
  value       = try(aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].reader_endpoint, "")
}

{{#if create_admin_user}}
output "memorydb_admin_username" {
  description = "Admin username for MemoryDB access"
  value       = var.admin_username
}

output "memorydb_admin_password" {
  description = "Admin password for MemoryDB access"
  value       = random_password.plugin_memorydb_admin_password.result
  sensitive   = true
}
{{/if}}

output "memorydb_engine_version" {
  description = "Redis engine version"
  value       = aws_memorydb_cluster.plugin_memorydb.engine_version
}

output "memorydb_parameter_group" {
  description = "Parameter group name"
  value       = aws_memorydb_parameter_group.plugin_memorydb.name
}

output "memorydb_acl_name" {
  description = "ACL name"
  value       = local.acl_name
}

output "memorydb_subnet_group" {
  description = "Subnet group name"
  value       = length(local.subnet_ids_list) > 0 ? aws_memorydb_subnet_group.plugin_memorydb[0].name : ""
}

output "memorydb_arn" {
  description = "ARN of the MemoryDB cluster"
  value       = aws_memorydb_cluster.plugin_memorydb.arn
}

output "memorydb_status" {
  description = "Status of the MemoryDB cluster"
  value       = aws_memorydb_cluster.plugin_memorydb.status
}

output "memorydb_shards" {
  description = "List of shards in the cluster"
  value       = aws_memorydb_cluster.plugin_memorydb.shards
}

output "memorydb_log_group" {
  description = "CloudWatch Log Group for MemoryDB"
  value       = aws_cloudwatch_log_group.plugin_memorydb.name
}

# Connection information
output "connection_info" {
  description = "How to connect to this MemoryDB cluster"
  value = <<-EOT
    MemoryDB Cluster: ${var.project_name}
    Engine: Redis ${aws_memorydb_cluster.plugin_memorydb.engine_version}
    Endpoint: ${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].address}:${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].port}
    Shards: ${var.num_shards}
    Replicas per Shard: ${var.num_replicas_per_shard}

    # Connect using redis-cli:
    {{#if tls_enabled}}
    redis-cli -h ${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].address} -p ${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].port} --tls{{#if create_admin_user}} -u ${var.admin_username} -a <PASSWORD>{{/if}}
    {{else}}
    redis-cli -h ${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].address} -p ${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].port}{{#if create_admin_user}} -u ${var.admin_username} -a <PASSWORD>{{/if}}
    {{/if}}

    {{#if create_admin_user}}
    # Get admin password:
    terraform output -raw memorydb_admin_password
    {{/if}}

    # Connection string format:
    redis://{{#if create_admin_user}}${var.admin_username}:<PASSWORD>@{{/if}}${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].address}:${aws_memorydb_cluster.plugin_memorydb.cluster_endpoint[0].port}

    Note: MemoryDB provides Multi-AZ durability and data persistence across restarts.
  EOT
}
