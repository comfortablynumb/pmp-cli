apiVersion: pmp.io/v1
kind: Plugin
metadata:
  name: memorydb
  description: Create an AWS MemoryDB for Redis cluster with Multi-AZ durability and ultra-fast performance for microservices

spec:
  role: durable-cache

  inputs:
    # Project Metadata
    project_name:
      type: string
      description: MemoryDB cluster name (defaults to project name)
      default: ""

    # Cluster Configuration
    node_type:
      type: select
      options:
        - label: "db.t4g.small (1.37 GB RAM)"
          value: "db.t4g.small"
        - label: "db.t4g.medium (3.09 GB RAM)"
          value: "db.t4g.medium"
        - label: "db.r7g.large (13.07 GB RAM)"
          value: "db.r7g.large"
        - label: "db.r7g.xlarge (26.32 GB RAM)"
          value: "db.r7g.xlarge"
        - label: "db.r7g.2xlarge (52.82 GB RAM)"
          value: "db.r7g.2xlarge"
      default: "db.t4g.small"
      description: Node instance type

    num_shards:
      type: number
      description: Number of shards in the cluster
      default: 1
      min: 1
      max: 500

    num_replicas_per_shard:
      type: number
      description: Number of replicas per shard (0-5)
      default: 1
      min: 0
      max: 5

    engine_version:
      type: select
      options:
        - label: "Redis 7.0"
          value: "7.0"
        - label: "Redis 6.2"
          value: "6.2"
      default: "7.0"
      description: Redis engine version

    port:
      type: number
      description: Port number for MemoryDB
      default: 6379
      min: 1024
      max: 65535

    # Security Settings
    tls_enabled:
      type: boolean
      description: Enable TLS encryption in transit
      default: true

    acl_name:
      type: string
      description: ACL name for access control (leave empty to create default ACL)
      default: ""

    # Snapshot Settings
    snapshot_retention_limit:
      type: number
      description: Number of days to retain automatic snapshots (0 to disable)
      default: 7
      min: 0
      max: 35

    snapshot_window:
      type: string
      description: Daily time range for automatic snapshots in UTC (e.g., "05:00-09:00")
      default: "05:00-09:00"

    # Maintenance Settings
    maintenance_window:
      type: string
      description: Weekly time range for maintenance in UTC (e.g., "sun:05:00-sun:07:00")
      default: "sun:05:00-sun:07:00"

    auto_minor_version_upgrade:
      type: boolean
      description: Enable automatic minor version upgrades during maintenance window
      default: true

    # Network Settings
    subnet_ids:
      type: string
      description: Comma-separated list of subnet IDs for the subnet group
      default: ""

    security_group_ids:
      type: string
      description: Comma-separated list of security group IDs
      default: ""

    # Performance Settings
    data_tiering:
      type: boolean
      description: Enable data tiering (automatically uses SSD for frequently accessed data)
      default: false

    # User Management
    create_admin_user:
      type: boolean
      description: Create an admin user with full Redis permissions
      default: true

    admin_username:
      type: string
      description: Admin username (only if create_admin_user is true)
      default: "admin"
