apiVersion: pmp.io/v1
kind: Plugin
metadata:
  name: ecs
  description: Deploy containerized applications on AWS ECS (Elastic Container Service) with Fargate or EC2 launch types

spec:
  role: container-orchestration

  inputs:
    # Project Metadata
    - name: project_name
      type: string
      description: ECS service name (defaults to project name)
      default: ""

    # Cluster Configuration
    - name: create_cluster
      type: boolean
      description: Create a new ECS cluster (if false, provide existing cluster name)
      default: true

    - name: cluster_name
      type: string
      description: ECS cluster name (created or existing)
      default: ""

    # Launch Type
    - name: launch_type
      type: select
      options:
        - label: "Fargate (Serverless)"
          value: "FARGATE"
        - label: "EC2 (Self-managed instances)"
          value: "EC2"
      default: "FARGATE"
      description: ECS launch type for the service

    # Container Configuration
    - name: container_image
      type: string
      description: Docker container image (e.g., nginx:latest or ECR URL)
      default: ""

    - name: container_port
      type: select
      options:
        - label: "80 (HTTP)"
          value: "80"
        - label: "443 (HTTPS)"
          value: "443"
        - label: "8080 (HTTP Alt)"
          value: "8080"
        - label: "3000 (Node.js)"
          value: "3000"
        - label: "8000 (Python)"
          value: "8000"
      default: "80"
      description: Container port to expose

    - name: cpu
      type: select
      options:
        - label: "256 (.25 vCPU)"
          value: "256"
        - label: "512 (.5 vCPU)"
          value: "512"
        - label: "1024 (1 vCPU)"
          value: "1024"
        - label: "2048 (2 vCPU)"
          value: "2048"
        - label: "4096 (4 vCPU)"
          value: "4096"
      default: "256"
      description: Task CPU units (for Fargate)

    - name: memory
      type: select
      options:
        - label: "512 MB"
          value: "512"
        - label: "1024 MB (1 GB)"
          value: "1024"
        - label: "2048 MB (2 GB)"
          value: "2048"
        - label: "3072 MB (3 GB)"
          value: "3072"
        - label: "4096 MB (4 GB)"
          value: "4096"
        - label: "8192 MB (8 GB)"
          value: "8192"
      default: "512"
      description: Task memory in MB (for Fargate)

    # Service Configuration
    - name: desired_count
      type: select
      options:
        - label: "1 task"
          value: "1"
        - label: "2 tasks"
          value: "2"
        - label: "3 tasks"
          value: "3"
        - label: "4 tasks"
          value: "4"
        - label: "5 tasks"
          value: "5"
      default: "2"
      description: Desired number of tasks to run

    # Network Configuration
    - name: assign_public_ip
      type: boolean
      description: Assign public IP to tasks (required for Fargate without NAT Gateway)
      default: true

    - name: vpc_id
      type: string
      description: VPC ID (leave empty to use default VPC)
      default: ""

    - name: subnet_ids
      type: string
      description: Comma-separated subnet IDs (leave empty to use default VPC subnets)
      default: ""

    # Load Balancer
    - name: create_load_balancer
      type: boolean
      description: Create an Application Load Balancer for the service
      default: false

    - name: load_balancer_port
      type: select
      options:
        - label: "80 (HTTP)"
          value: "80"
        - label: "443 (HTTPS)"
          value: "443"
      default: "80"
      description: Load balancer listener port

    # Auto-scaling
    - name: enable_autoscaling
      type: boolean
      description: Enable auto-scaling for the ECS service
      default: false

    - name: min_capacity
      type: select
      options:
        - label: "1 task"
          value: "1"
        - label: "2 tasks"
          value: "2"
        - label: "3 tasks"
          value: "3"
      default: "1"
      description: Minimum number of tasks for auto-scaling

    - name: max_capacity
      type: select
      options:
        - label: "4 tasks"
          value: "4"
        - label: "6 tasks"
          value: "6"
        - label: "10 tasks"
          value: "10"
        - label: "20 tasks"
          value: "20"
      default: "4"
      description: Maximum number of tasks for auto-scaling

    - name: target_cpu_utilization
      type: select
      options:
        - label: "50%"
          value: "50"
        - label: "70%"
          value: "70"
        - label: "80%"
          value: "80"
      default: "70"
      description: Target CPU utilization percentage for auto-scaling

    # CloudWatch Logs
    - name: log_retention_days
      type: select
      options:
        - label: "1 day"
          value: "1"
        - label: "7 days"
          value: "7"
        - label: "14 days"
          value: "14"
        - label: "30 days"
          value: "30"
        - label: "90 days"
          value: "90"
      default: "7"
      description: CloudWatch Logs retention period

    # Environment Variables
    - name: environment_variables
      type: string
      description: Environment variables as key=value pairs, comma-separated (e.g., ENV=prod,DEBUG=false)
      default: ""
