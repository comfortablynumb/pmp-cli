apiVersion: pmp.io/v1
kind: Plugin
metadata:
  name: secretsmanager
  description: Create and manage AWS Secrets Manager secrets with automatic rotation, encryption, and versioning for secure credential storage

spec:
  role: secrets-management

  inputs:
    # Project Metadata
    - name: project_name
      type: string
      description: Secret name prefix (defaults to project name)
      default: ""

    # Secret Configuration
    - name: secret_description
      type: string
      description: Description of the secret
      default: ""

    - name: secret_type
      type: select
      options:
        - label: "Key-Value Pairs (JSON)"
          value: "json"
        - label: "Plain Text"
          value: "plaintext"
        - label: "Auto-generated Random Password"
          value: "random"
      default: "json"
      description: Type of secret to store

    # Random Secret Generation (when secret_type is "random")
    - name: password_length
      type: number
      description: Length of auto-generated password
      default: 32
      min: 8
      max: 128

    - name: exclude_characters
      type: string
      description: Characters to exclude from auto-generated password
      default: "/@\"\\"

    - name: require_each_included_type
      type: boolean
      description: Require at least one character from each character type
      default: true

    # Encryption Settings
    - name: kms_key_id
      type: string
      description: KMS key ID for encryption (leave empty to use AWS managed key)
      default: ""

    # Rotation Settings
    - name: enable_rotation
      type: boolean
      description: Enable automatic secret rotation
      default: false

    - name: rotation_days
      type: number
      description: Number of days between automatic rotations
      default: 30
      min: 1
      max: 365

    - name: rotation_lambda_arn
      type: string
      description: ARN of Lambda function for rotation (required if rotation enabled)
      default: ""

    # Recovery Settings
    - name: recovery_window_days
      type: number
      description: Recovery window in days before permanent deletion (0 for immediate, 7-30 recommended)
      default: 7
      min: 0
      max: 30

    # Replication Settings
    - name: enable_replication
      type: boolean
      description: Enable cross-region replication
      default: false

    - name: replica_regions
      type: string
      description: Comma-separated list of AWS regions for replication (e.g., us-west-2,eu-west-1)
      default: ""

    # Tagging
    - name: application
      type: string
      description: Application name for tagging
      default: ""

    - name: environment
      type: string
      description: Environment name for tagging (dev, staging, prod)
      default: ""

    # Secret Value Templates
    - name: create_database_secret
      type: boolean
      description: Create a database connection secret template
      default: false

    - name: db_engine
      type: select
      options:
        - label: "PostgreSQL"
          value: "postgres"
        - label: "MySQL"
          value: "mysql"
        - label: "MariaDB"
          value: "mariadb"
        - label: "SQL Server"
          value: "sqlserver"
        - label: "Oracle"
          value: "oracle"
      default: "postgres"
      description: Database engine type (only if create_database_secret is true)

    - name: db_host
      type: string
      description: Database host/endpoint
      default: ""

    - name: db_port
      type: number
      description: Database port
      default: 5432
      min: 1
      max: 65535

    - name: db_name
      type: string
      description: Database name
      default: ""

    - name: db_username
      type: string
      description: Database username
      default: ""

    # API Key Secret Template
    - name: create_api_key_secret
      type: boolean
      description: Create an API key secret template
      default: false

    - name: api_key_name
      type: string
      description: API key name/service identifier
      default: ""
