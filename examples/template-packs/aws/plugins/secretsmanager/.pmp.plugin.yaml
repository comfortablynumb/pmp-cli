apiVersion: pmp.io/v1
kind: Plugin
metadata:
  name: secretsmanager
  description: Create and manage AWS Secrets Manager secrets with automatic rotation, encryption, and versioning for secure credential storage

spec:
  role: secrets-management

  inputs:
    # Project Metadata
    project_name:
      type: string
      description: Secret name prefix (defaults to project name)
      default: ""

    # Secret Configuration
    secret_description:
      type: string
      description: Description of the secret
      default: ""

    secret_type:
      type: select
      options:
        - label: "Key-Value Pairs (JSON)"
          value: "json"
        - label: "Plain Text"
          value: "plaintext"
        - label: "Auto-generated Random Password"
          value: "random"
      default: "json"
      description: Type of secret to store

    # Random Secret Generation (when secret_type is "random")
    password_length:
      type: number
      description: Length of auto-generated password
      default: 32
      min: 8
      max: 128

    exclude_characters:
      type: string
      description: Characters to exclude from auto-generated password
      default: "/@\"\\"

    require_each_included_type:
      type: boolean
      description: Require at least one character from each character type
      default: true

    # Encryption Settings
    kms_key_id:
      type: string
      description: KMS key ID for encryption (leave empty to use AWS managed key)
      default: ""

    # Rotation Settings
    enable_rotation:
      type: boolean
      description: Enable automatic secret rotation
      default: false

    rotation_days:
      type: number
      description: Number of days between automatic rotations
      default: 30
      min: 1
      max: 365

    rotation_lambda_arn:
      type: string
      description: ARN of Lambda function for rotation (required if rotation enabled)
      default: ""

    # Recovery Settings
    recovery_window_days:
      type: number
      description: Recovery window in days before permanent deletion (0 for immediate, 7-30 recommended)
      default: 7
      min: 0
      max: 30

    # Replication Settings
    enable_replication:
      type: boolean
      description: Enable cross-region replication
      default: false

    replica_regions:
      type: string
      description: Comma-separated list of AWS regions for replication (e.g., us-west-2,eu-west-1)
      default: ""

    # Tagging
    application:
      type: string
      description: Application name for tagging
      default: ""

    environment:
      type: string
      description: Environment name for tagging (dev, staging, prod)
      default: ""

    # Secret Value Templates
    create_database_secret:
      type: boolean
      description: Create a database connection secret template
      default: false

    db_engine:
      type: select
      options:
        - label: "PostgreSQL"
          value: "postgres"
        - label: "MySQL"
          value: "mysql"
        - label: "MariaDB"
          value: "mariadb"
        - label: "SQL Server"
          value: "sqlserver"
        - label: "Oracle"
          value: "oracle"
      default: "postgres"
      description: Database engine type (only if create_database_secret is true)

    db_host:
      type: string
      description: Database host/endpoint
      default: ""

    db_port:
      type: number
      description: Database port
      default: 5432
      min: 1
      max: 65535

    db_name:
      type: string
      description: Database name
      default: ""

    db_username:
      type: string
      description: Database username
      default: ""

    # API Key Secret Template
    create_api_key_secret:
      type: boolean
      description: Create an API key secret template
      default: false

    api_key_name:
      type: string
      description: API key name/service identifier
      default: ""
