variable "secret_path" {
  description = "Path within the KV mount where the secret will be stored (e.g., 'myapp/config')"
  type        = string
  default     = "{{secret_path}}"
}

variable "secret_data" {
  description = "Secret data as a JSON object"
  type        = string
  default     = {{#if secret_data}}"{{secret_data}}"{{else}}"{}"{{/if}}
  sensitive   = true

  validation {
    condition     = can(jsondecode(var.secret_data))
    error_message = "Secret data must be valid JSON"
  }
}

variable "cas" {
  description = "Check-and-Set version for secret updates (0 for new secrets, specific version for updates)"
  type        = number
  default     = {{cas}}

  validation {
    condition     = var.cas >= 0
    error_message = "CAS must be a non-negative number"
  }
}

variable "delete_all_versions" {
  description = "Delete all versions of the secret when applying destroy"
  type        = bool
  default     = {{bool delete_all_versions}}
}

# Connection parameters from reference vault project
# These are passed from the parent module via the data source

variable "kv_mount_path" {
  description = "KV v2 mount path from reference Vault project"
  type        = string
}

variable "vault_address" {
  description = "Vault server address from reference Vault project"
  type        = string
}

# Kubernetes auth backend configuration

variable "kubernetes_auth_path" {
  description = "Path to the Kubernetes auth backend in Vault"
  type        = string
  default     = "{{kubernetes_auth_path}}"
}

variable "kubernetes_service_accounts" {
  description = "List of Kubernetes service accounts allowed to use this role"
  type        = list(string)
  default     = {{#if kubernetes_service_accounts}}[{{#each (split kubernetes_service_accounts ",")}}"{{trim this}}"{{#unless @last}}, {{/unless}}{{/each}}]{{else}}["*"]{{/if}}
}

variable "kubernetes_namespaces" {
  description = "List of Kubernetes namespaces where the service accounts are located"
  type        = list(string)
  {{#if kubernetes_namespaces}}
  default     = [{{#each (split kubernetes_namespaces ",")}}"{{trim this}}"{{#unless @last}}, {{/unless}}{{/each}}]
  {{else}}
  # No default - must be specified by the user
  {{/if}}
}

variable "token_ttl" {
  description = "TTL for tokens issued by this role (in seconds)"
  type        = number
  default     = {{token_ttl}}
}

variable "token_max_ttl" {
  description = "Maximum TTL for tokens issued by this role (in seconds)"
  type        = number
  default     = {{token_max_ttl}}
}
