{{#if (eq enable_branch_protection "true")}}
# Branch protection for default branch
resource "github_branch_protection" "plugin_default_branch" {
  repository_id = github_repository.plugin_repo.node_id
  pattern       = var.default_branch

  # Pull request reviews (opinionated defaults for app development)
  required_pull_request_reviews {
    dismiss_stale_reviews           = true
    require_code_owner_reviews      = false
    required_approving_review_count = var.required_approving_review_count
  }

  # Other protection settings
  enforce_admins         = false
  require_signed_commits = false

  # Allow force pushes and deletions are disabled by default
  allows_force_pushes = false
  allows_deletions    = false

  depends_on = [
    github_repository.plugin_repo
    {{#if (ne default_branch "main")}}
    , github_branch_default.plugin_default
    {{/if}}
  ]
}
{{/if}}
