variable "role_name" {
  description = "Database role/user name to create"
  type        = string
  default     = "{{database_name}}"
}

variable "role_password" {
  description = "Password for the role (auto-generated if not provided)"
  type        = string
  default     = "{{role_password}}"
  sensitive   = true
}

variable "database_name" {
  description = "Database to grant access to"
  type        = string
  default     = "{{database_name}}"
}

variable "privileges" {
  description = "Array of privileges to grant (SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER, ALL)"
  type        = list(string)
  default     = {{#if privileges}}[{{#each privileges}}"{{this}}"{{#unless @last}}, {{/unless}}{{/each}}]{{else}}["SELECT"]{{/if}}

  validation {
    condition = alltrue([
      for priv in var.privileges : contains([
        "SELECT", "INSERT", "UPDATE", "DELETE",
        "TRUNCATE", "REFERENCES", "TRIGGER", "ALL"
      ], priv)
    ])
    error_message = "Privileges must be one of: SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER, ALL"
  }
}

variable "grant_option" {
  description = "Allow user to grant privileges to others"
  type        = bool
  default     = {{bool grant_option}}
}

variable "connection_limit" {
  description = "Maximum concurrent connections (-1 for unlimited)"
  type        = number
  default     = {{connection_limit}}

  validation {
    condition     = var.connection_limit >= -1
    error_message = "Connection limit must be -1 (unlimited) or a positive number."
  }
}

variable "valid_until" {
  description = "Password expiration timestamp (format: YYYY-MM-DD HH:MM:SS)"
  type        = string
  default     = "{{valid_until}}"
}

variable "schema_name" {
  description = "Schema to grant privileges on"
  type        = string
  default     = "{{schema_name}}"
}

variable "create_schema" {
  description = "Allow user to create schemas"
  type        = bool
  default     = {{bool create_schema}}
}

variable "superuser" {
  description = "Grant superuser privileges (WARNING - use with caution)"
  type        = bool
  default     = {{bool superuser}}
}

variable "create_role" {
  description = "Allow user to create other roles"
  type        = bool
  default     = {{bool create_role}}
}

variable "create_db" {
  description = "Allow user to create databases"
  type        = bool
  default     = {{bool create_db}}
}

# Connection parameters from reference postgres project
# These are passed from the parent module via the data source

variable "postgres_host" {
  description = "PostgreSQL host from reference project"
  type        = string
}

variable "postgres_port" {
  description = "PostgreSQL port from reference project"
  type        = number
}

variable "postgres_database" {
  description = "PostgreSQL database name from reference project"
  type        = string
}

variable "postgres_username" {
  description = "PostgreSQL username from reference project"
  type        = string
}

variable "postgres_password" {
  description = "PostgreSQL password from reference project"
  type        = string
  sensitive   = true
}

variable "postgres_sslmode" {
  description = "PostgreSQL SSL mode from reference project"
  type        = string
}

variable "postgres_service_name" {
  description = "PostgreSQL service name from reference project"
  type        = string
}

variable "postgres_namespace" {
  description = "PostgreSQL namespace from reference project"
  type        = string
}