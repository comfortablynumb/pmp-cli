apiVersion: pmp.io/v1
kind: Template
metadata:
  name: k8s-monitoring
  description: Deploy Grafana k8s-monitoring stack with auto-detection for Grafana Cloud or custom endpoints

spec:
  apiVersion: pmp.io/v1
  kind: K8sMonitoring
  executor: opentofu

  inputs:
    - name: namespace
      default: "monitoring"
      description: Kubernetes namespace for monitoring stack
    - name: chart_version
      default: "1.5.7"
      description: k8s-monitoring Helm chart version
    - name: create_namespace
      default: true
      description: Create the namespace if it doesn't exist
    - name: cluster_name
      description: Cluster name for identification in metrics/logs
    - name: grafana_cloud_url
      default: ""
      description: Grafana Cloud URL (e.g., https://prometheus-prod-01-eu-west-0.grafana.net). If set, auto-configures for Grafana Cloud
    - name: grafana_cloud_token
      default: ""
      description: Grafana Cloud API token (if using Grafana Cloud)
    - name: prometheus_url
      default: ""
      description: Custom Prometheus remote write URL (used if grafana_cloud_url is empty)
    - name: prometheus_username
      default: ""
      description: Prometheus authentication username
    - name: prometheus_password
      default: ""
      description: Prometheus authentication password
    - name: loki_url
      default: ""
      description: Custom Loki URL (used if grafana_cloud_url is empty)
    - name: loki_username
      default: ""
      description: Loki authentication username
    - name: loki_password
      default: ""
      description: Loki authentication password
    - name: tempo_url
      default: ""
      description: Custom Tempo URL (used if grafana_cloud_url is empty)
    - name: tempo_username
      default: ""
      description: Tempo authentication username
    - name: tempo_password
      default: ""
      description: Tempo authentication password
    - name: metrics_enabled
      default: true
      description: Enable metrics collection
    - name: logs_enabled
      default: true
      description: Enable logs collection
    - name: traces_enabled
      default: false
      description: Enable traces collection
    - name: log_level
      enum_values:
        - "debug"
        - "info"
        - "warn"
        - "error"
      default: "info"
      description: Log level for monitoring components
    - name: kube_state_metrics_enabled
      default: true
      description: Enable kube-state-metrics for cluster state metrics
    - name: node_exporter_enabled
      default: true
      description: Enable node-exporter for node metrics
    - name: opencost_enabled
      default: false
      description: Enable OpenCost for cost monitoring
    - name: alloy_cpu_request
      default: "200m"
      description: Grafana Alloy CPU request
    - name: alloy_cpu_limit
      default: "1000m"
      description: Grafana Alloy CPU limit
    - name: alloy_memory_request
      default: "128Mi"
      description: Grafana Alloy memory request
    - name: alloy_memory_limit
      default: "512Mi"
      description: Grafana Alloy memory limit
    - name: prometheus_scrape_interval
      default: "60s"
      description: Prometheus scrape interval
    - name: logs_pod_logs_enabled
      default: true
      description: Collect pod logs
    - name: logs_cluster_events_enabled
      default: true
      description: Collect cluster events

  environments: {}
