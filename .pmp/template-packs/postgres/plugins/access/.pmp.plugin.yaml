apiVersion: pmp.io/v1
kind: Plugin
metadata:
  name: access
  description: Create database user credentials with configurable privileges

spec:
  role: credential-management

  inputs:
    role_name:
      description: Database role/user name to create
      # No default - required input

    role_password:
      description: Password for the role (auto-generated if not provided)
      default: ""

    database_name:
      description: Database to grant access to
      default: ""  # Inherited from parent template

    privileges:
      description: Array of privileges to grant (SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER)
      default: ["SELECT"]

    grant_option:
      description: Allow user to grant privileges to others
      default: false

    connection_limit:
      description: Maximum concurrent connections (-1 for unlimited)
      default: -1

    valid_until:
      description: Password expiration timestamp (format YYYY-MM-DD HH:MM:SS)
      default: ""

    schema_name:
      description: Schema to grant privileges on
      default: "public"

    create_schema:
      description: Allow user to create schemas
      default: false

    superuser:
      description: Grant superuser privileges (WARNING - use with caution)
      default: false

    create_role:
      description: Allow user to create other roles
      default: false

    create_db:
      description: Allow user to create databases
      default: false

    create_k8s_secret:
      description: Store credentials in Kubernetes secret
      default: true

    k8s_secret_name:
      description: Name for the Kubernetes secret (auto-generated if empty)
      default: ""

    k8s_secret_namespace:
      description: Namespace for the Kubernetes secret
      default: ""  # Inherited from parent template
